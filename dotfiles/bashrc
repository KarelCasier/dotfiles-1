#!/usr/bin/env bash

# Load ARC path
source ~/.adrc

# Manually set your language environment
export LANG=en_US.UTF-8

# Preferred editor for local and remote sessions
export EDITOR="vim"
export VISUAL="$EDITOR"

# Add nice ls mods
alias ls="ls -CF"
alias ll="ls -lhA"

# Adjust path to use bin in user/bin
export PATH="$ARC/usr/bin:$HOME/.local/bin:$PATH"

# Set tab title to show only current directory and not full path
# export PROMPT_COMMAND='echo -ne "\033];${PWD##*/}\007";'

if [ -z $TMUX ]; then
  # Enable 256 color mode
  export TERM="xterm-256color"
fi

# Set custom prompt
if [ -n "$SSH_CLIENT" ] || [ -n "$SSH_TTY" ]; then
  export PS1=' > '
else
  export PS1=' \[\e[32;1m\]Î»\[\e[0m\] '
fi

# Base 16
BASE16_SHELL=$ARC/lib/bash/base16-shell/
[ -n "$PS1" ] && [ -s $BASE16_SHELL/profile_helper.sh ] && eval "$($BASE16_SHELL/profile_helper.sh)"
base16_tomorrow-night

# Better history
shopt -s histappend
shopt -s cmdhist
export HISTFILESIZE=1000000
export HISTSIZE=1000000
export HISTCONTROL=ignoreboth
export HISTIGNORE='ls:bg:fg:history'
export HISTTIMEFORMAT='%F %T '
export PROMPT_COMMAND="history -a;$PROMPT_COMMAND"

# Init fasd with cache to speed up startup
source "$ARC/lib/bash/fasd/fasd" > /dev/null
fasd_cache=~/.fasd-init-cache
if [ "$(command -v fasd)" -nt "$fasd_cache" -o ! -s "$fasd_cache" ]; then
  fasd --init posix-alias bash-hook bash-ccomp bash-ccomp-install >| "$fasd_cache"
fi
source "$fasd_cache"
unset fasd_cache

# Load rest of libraries
source $ARC/lib/bash/todo.txt-cli/todo_completion
alias todo.sh='$ARC/lib/bash/todo.txt-cli/todo.sh'
command -v thefuck >/dev/null 2>&1 && eval "$(thefuck --alias)"
command -v hub >/dev/null 2>&1 && eval "$(hub alias -s)"
alias zi="fasd -e cd -i"

# Fast edit rc files
arc() {
  eval "$EDITOR $ARC/usr/$1"
}

# Add link to binary to $ARC/user/bin path
arclink() {
  local name=`basename $1`
  local curpath="$PWD/$1"
  ln -s $curpath "$ARC/usr/bin/$name"
}

# Awesome Star Wars alias
alias starwars="telnet towel.blinkenlights.nl"

# Load user config
[[ -f "$ARC/usr/bashrc" ]] &&
  source "$ARC/usr/bashrc"

# Load fzf last to override possible bash-completion
source ~/.fzf.bash
