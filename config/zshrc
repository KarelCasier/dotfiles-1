# vim:foldmethod=marker:set ft=zsh:

# General {{{

  # Source .profile
  if [ -f ~/.profile ]; then
    source ~/.profile
  fi

  # Enable colors
  export CLICOLOR=1

  # We want to use old ugly stuff
  setopt sh_word_split

# }}}

# Aliases & functions {{{

  # Switch to neovim
  alias vim='nvim'

  # Open Vim and start saving it's session
  function vsession () {
    $EDITOR +Session
  }

  # Super cool gource alias (requires gource)
  alias gource="gource --key --stop-at-end -i 0 --highlight-dirs --highlight-all-users --max-file-lag 0.5"

  # Hastebin fast share
  haste() { a=$(cat); curl -X POST -s -d "$a" https://hastebin.com/documents | awk -F '"' '{print "https://hastebin.com/"$4}'; }

# }}}

# Plugins {{{

  # Load fasd
  source "$DOTHOME/lib/shell/fasd/fasd" > /dev/null
  fasd_cache=~/.fasd-init-cache
  if [ "$(command -v fasd)" -nt "$fasd_cache" -o ! -s "$fasd_cache" ]; then
    fasd --init auto >| "$fasd_cache"
  fi
  source "$fasd_cache"
  unset fasd_cache
  alias v="f -e $EDITOR"
  alias o='a -e open_command'

  # Load zplug
  source "$DOTHOME/lib/shell/zplug/init.zsh"

  # Libraries from oh-my-zsh
  zplug "lib/clipboard", from:oh-my-zsh
  zplug "lib/completion", from:oh-my-zsh
  zplug "lib/directories", from:oh-my-zsh
  zplug "lib/grep", from:oh-my-zsh
  zplug "lib/history", from:oh-my-zsh
  zplug "lib/misc", from:oh-my-zsh
  zplug "lib/theme-and-appearance", from:oh-my-zsh

  # Plugins from oh-my-zsh
  zplug "plugins/brew", from:oh-my-zsh
  zplug "plugins/colored-man-pages", from:oh-my-zsh
  zplug "plugins/command-not-found", from:oh-my-zsh
  zplug "plugins/docker", from:oh-my-zsh
  zplug "plugins/extract", from:oh-my-zsh
  zplug "plugins/git", from:oh-my-zsh
  zplug "plugins/github", from:oh-my-zsh
  zplug "plugins/heroku", from:oh-my-zsh
  zplug "plugins/mvn", from:oh-my-zsh
  zplug "plugins/pass", from:oh-my-zsh
  zplug "plugins/pip", from:oh-my-zsh
  zplug "plugins/tmux", from:oh-my-zsh
  zplug "plugins/vagrant", from:oh-my-zsh
  zplug "plugins/vi-mode", from:oh-my-zsh

  # External plugins
  zplug "zsh-users/zsh-syntax-highlighting", from:github, defer:2
  zplug "mafredri/zsh-async", from:github
  zplug "sindresorhus/pure", use:pure.zsh, from:github, as:theme

  # Install plugins if there are plugins that have not been installed
  if ! zplug check --verbose; then
    printf "Install? [y/N]: "
    if read -q; then
      echo; zplug install
    fi
  fi

  # Then, source plugins and add commands to $PATH
  zplug load --verbose

  # Base 16
  eval "$($DOTHOME/lib/shell/base16-shell/profile_helper.sh)"
  [ -z $BASE16_THEME ] && base16_solarized-dark

  # Load fzf
  source ~/.fzf.zsh

  # Use faster FZF grep command if possible
  if command -v rg >/dev/null 2>&1; then
    export FZF_DEFAULT_COMMAND='rg --files --hidden --follow --glob "!.git/*"'
  elif command -v ag >/dev/null 2>&1; then
    export FZF_DEFAULT_COMMAND='ag -g ""'
  fi

# }}}

# User configuration {{{

  # Load user config
  [[ -f "$DOTHOME/usr/zshrc" ]] &&
    source "$DOTHOME/usr/zshrc"

# }}}
